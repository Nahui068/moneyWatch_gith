<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="account_card">

	<!-- 카드 정보 가져오기 -->
	<select id="card_select" resultType="cardDTO">
		select * from mwCard
	</select>
	
	<!-- 카드사 및 카드이름, 카드이미지번호-->
	<select id="card_cn" resultType="cardDTO" parameterType="String">
		select distinct company,card_name,img_cnt from mwCard where company = #{value}
	</select>
	
	<!-- 카드사 -->
	<select id="card_company" resultType="cardDTO">
		select distinct company from mwCard
	</select>
	
	<!-- 카드등록 -->
	<insert id="card_insert" parameterType="reg_cardDTO">
		insert into mwRegisterCard values(reg_card_seq.nextval,#{id},#{card_company},#{card_name},#{card_nickname},#{account_company},#{account_num},#{balance})
	</insert>
	
	<!-- 계좌등록 -->
	<insert id="account_insert" parameterType="reg_accountDTO">
		insert into mwRegisterAccount values(reg_account_seq.nextval,#{id},#{account_company},#{account_num},#{balance})
	</insert>
	
	<!-- 카드 정보 이미지 DB insert -->
	<insert id="card_img_insert" parameterType="card_imgDTO">
		insert into card_img values(card_seq.nextval,#{img_cnt},#{company},#{path})
	</insert>
	
	<!-- 카드명에 따른 카드혜택 -->
	<select id="card_benefit" resultType="cardDTO" parameterType="String">
		select * from mwCard where card_name = #{card_name}
	</select> 
	
	<!-- 카드이미지 -->
 	<select id="card_img" resultType="card_imgDTO">
		select * from card_img;
	</select>
	
	<!-- 나의 카드 정보 -->
	<select id="mycard" resultType="reg_cardDTO" parameterType="String">
		select * from mwRegisterCard where id=#{id}
	</select>

	<!-- 나의 계좌 정보 -->
	<select id="myaccount" resultType="reg_accountDTO" parameterType="String">
		select * from mwRegisterAccount where id=#{id}
	</select>
	
	<!-- 나의 카드 삭제 -->
	<delete id="mycard_del" parameterType="hashmap">
		delete from mwRegisterCard where id=#{id} and num=#{num}
	</delete>
	
	<!-- 나의 계좌 삭제 -->
	<delete id="myaccount_del" parameterType="hashmap">
		delete from mwRegisterAccount where id=#{id} and num=#{num}
	</delete>
	
	<!-- 나의 카드혜택 보기 -->
	<select id="my_ac_benefit" resultType="cardDTO" parameterType="String">
		select * from mwCard where card_name in (select card_name from mwRegisterCard where card_name like '%' || #{card_name} || '%') 
	</select>

	<!-- 계좌중복확인 -->
	<select id="check_account" resultType="int" parameterType="hashmap">
		select count(*) from mwRegisterAccount where id=#{id} and account_num=#{account_num}
	</select>
	
	<!-- 카드에 대한 연결된 계좌 중복확인 -->
	<select id="check_card" resultType="int" parameterType="hashmap">
		select count(*) from mwRegisterCard where id=#{id} and card_name=#{card_name} and account_num=#{account_num}
	</select>
</mapper>