<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

 
<mapper namespace="sense">

	<!-- 메인 동영상 / 메인페이지/ 랜덤 카테고리 출력 후 해당 카테고리인 랜덤 영상을 출력-->
	<select id="mainVideo" resultType="senseDTO">
			<!-- DB main_set의 값이 1 일때, 메인 -->
	<![CDATA[
		select * from (
		   select * from mwsense where main_set=${0} and sense_category=(
		       select sense_detail_category from 
		            (select * from mwsense_category order by dbms_random.value)
		        where rownum <= 1
		    )
		) where rownum <= 1 		
		]]>	<!-- <= 등호 처리  -->
	</select>
	
	<!-- 메인 리스트 출력 / 메인페이지-->
	<select id="mainList" resultType="senseDTO">
		select num, sense_category, sense_title, sense_content, sense_url, sense_thumbnail from mwsense where main_set=${0} order by num desc <!-- DB main_set의 값이 1 일때, 메인 -->
	</select>

	<!-- 카테고리 선택시 / 메인페이지-->	
	<select id="categorySelect" resultType="senseDTO" parameterType="int">
		select * from mwsense where main_set=${0} and sense_category=(
				select sense_detail_category from mwsense_category where num=#{num} 
			)
		order by num desc
	</select>
	
	<!-- 디테일 비디오 변경 - 메인 영상을 변경해줌 -->
	<select id="senseDetailVideo" resultType="String" parameterType="int">
		select sense_url from mwsense where num=#{num}
	</select>
	
	<!-- 디테일 페이지/ 수정 페이지 -->
	<select id="select" resultType="senseDTO" parameterType="int">
		select * from mwsense where num=${num}
	</select>	
	
	<!-- 카테고리 리스트 / 센스 입력시  -->
	<select id="category" resultType="sensecategoryDTO">
		select * from mwsense_category order by num asc
	</select>
		
	<!-- 센스 직접 입력 /  파일제외-->
	<insert id="insert" parameterType="senseDTO">
		insert into mwsense values (
			mwsense_seq.nextval, 
			#{main_set},
			#{sense_category},
			#{sense_title},
			#{sense_content},
			#{sense_url}, 
			null,
			sysdate)
	</insert>	
	
	<!-- ID confirm -->
	<select id="confirmId" resultType="int" parameterType="String">
	</select>
	
	<!-- 센스 직접 입력 확인 -->
	<select id="insertCheck" resultType="int" parameterType="senseDTO">
		select count(*) from mwsense where sense_url=#{sense_url}
	</select>
	
	<!-- 파일업로드를 하기 위한 max num값 출력 -->
	<select id="maxNum" resultType="int">
		select max(num) from mwsense
	</select>
	
	<!-- 센스 게시글 수정 -->
	<update id="senseModify" parameterType="senseDTO">
		update mwsense
		<trim prefix="set" suffixOverrides=",">
			<if test="num != null">num=#{num},</if>
			<if test="main_set !=null">main_set=#{main_set},</if>
			<if test="sense_category != null">sense_category=#{sense_category},</if>
			<if test="sense_title != null">sense_title=#{sense_title},</if>
			<if test="sense_content != null">sense_content=#{sense_content},</if>
			<if test="sense_url != null">sense_url=#{sense_url},</if>
			<if test="sense_thumbnail != null">sense_thumbnail=#{sense_thumbnail},</if>
			<if test="reg_date != null">reg_date=sysdate</if>
		</trim>
		where num=#{num}
	</update>
	
	<!-- 센스 수정 확인 -->
	<select id="modifyCheck" resultType="int" parameterType="senseDTO">
		select count(*) from mwsense 
			where num=#{num} 
				and main_set=#{main_set} 
				and sense_category=#{sense_category} 
				and sense_content=#{sense_content} 
				and sense_url=#{sense_url} 
				and sense_thumbnail=#{sense_thumbnail}
	</select>
	
														
</mapper>
