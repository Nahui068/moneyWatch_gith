<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="moneyio">

	<select id="bankName" resultType="mycardDTO" ><!-- parameterType="String" --> 
		select ca_company from mwRegister_CA where id='nahui068' order by ca_name asc
	</select>
	
	<select id="bankAccount" resultType="mycardDTO" parameterType="String" >
		select ca_name from mwRegister_CA where id='nahui068' and ca_company=#{value} 
	</select>
	
	<!-- 지출/수입 insert -->
	<insert id="insert" parameterType="moneyioDTO">
		insert into mwmoneyio values(mwmoneyio_seq.nextval,#{io_category},#{io_detail},#{io_reg_date},#{io_price},#{io_remain},#{io_bank},
		#{io_account},#{id},#{io_N_div},#{io_set},(select 2020-Birth_y+1 from mwmember where id=#{id}))
	</insert>
	
	<!-- 지출/수입  n빵 내역 insert -->
	<insert id="n_insert" parameterType="nbreadDTO">
	insert into mwn_bread values(mwnbread_seq.nextval,(select max(io_num) from mwmoneyio), (select id from mwmoneyio where io_num = (select max(io_num) from mwmoneyio))
 		, (select io_category from mwmoneyio where io_num = (select max(io_num) from mwmoneyio)),#{n_debtor},#{n_price})
	</insert>
	
	<!-- 지출/수입 내역 수정페이지 데이터 -->	
	<select id="updateForm" resultType="moneyioDTO" parameterType="int">
		select * from mwmoneyio where io_num = #{io_num} 
	</select>
	
	<!-- 지출/수입 n빵 내역 수정페이지 데이터 -->
	<select id="n_updateForm" resultType="nbreadDTO" parameterType="int">
		select * from mwnbread where n_num = #{n_num}
	</select>
	
	<!-- 지출/수입 내역 update -->
	<update id="update" parameterType="int">
		update mwmoneyio 
		<trim prefix="set" suffixOverrides=",">
			<if test="io_category != null">io_category=#{io_category},</if>
			<if test="io_detail !=null">io_detail = #{io_detail},</if>
			<if test="io_reg_date != null">io_reg_date = #{io_reg_date},</if>
			<if test="io_price != null">io_price = #{io_price},</if>
			<if test="io_remain != null">io_remain = #{io_remain},</if>
			<if test="io_bank !=null">io_bank = #{io_bank},</if>
			<if test="io_account !=null">io_account = #{io_account},</if>
			<if test="io_n_div != null">io_n_div = #{io_n_div},</if>
			<if test="io_set != null">io_set = #{io_set}</if>
		</trim>
		where io_num=#{io_num}
	</update>
	
	<!-- 지출/수입 n빵 내역 update -->
	<update id="n_update" parameterType="int">
		update mwnbread 
		<trim prefix="set" suffixOverrides=",">
			<if test="n_category != null">n_category = #{n_category},</if>
			<if test="n_debtor != null">n_debtor=#{n_debtor},</if>
			<if test="n_price != null">n_price = #{n_price}</if>
		</trim>
		where n_num = #{n_num}
	</update>
	
	<!-- 연령대별 지출 chart-20대 -->
	<select id="chart20" resultType="moneyioDTO">
	<![CDATA[
		select * from(
    		select io_category, sum(io_price) as io_price from mwmoneyio where (
        	io_age between '20' and '29') and io_category not in('n빵비', '기타') and io_set=1
    		group by io_category
    		order by io_price desc
		)where rownum <= 5
	]]>
	</select>
	
	<!-- 연령대별 지출 chart-30대 -->
	<select id="chart30" resultType="moneyioDTO">
	<![CDATA[
		select * from(
    		select io_category, sum(io_price) as io_price from mwmoneyio where (
        	io_age between '30' and '39') and io_category not in('n빵비', '기타') and io_set=1
    		group by io_category
    		order by io_price desc
		)where rownum <= 5
	]]>
	</select>
	
	<!-- 연령대별 지출 chart-40대 -->
	<select id="chart40" resultType="moneyioDTO">
	<![CDATA[
		select * from(
    		select io_category, sum(io_price) as io_price from mwmoneyio where (
        	io_age between '40' and '49') and io_category not in('n빵비', '기타') and io_set=1
    		group by io_category
    		order by io_price desc
		)where rownum <= 5
	]]>
	</select>


	<select id="moneyioListAll" resultType="moneyioDTO" parameterType="String">
		select * from mwmoneyio where id = #{id} order by io_num desc
	</select>
	
	<select id="moneyioListIn" resultType="moneyioDTO" parameterType="String">
		select * from mwmoneyio where id = #{id} and io_set = 0 order by io_num desc
	</select>
	
	<select id="moneyioListOut" resultType="moneyioDTO" parameterType="String">
		select * from mwmoneyio where id = #{id} and io_set = 1 order by io_num desc
	</select>

	<select id="moneyioListDetail" resultType="moneyioDTO" parameterType="hashmap">
		select * from mwmoneyio where id = #{id} and io_num = #{ioNum}
	</select>
	
</mapper>