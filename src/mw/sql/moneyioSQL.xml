<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="moneyio">

	<select id="bankName" resultType="mycardDTO" parameterType="String" >
		select ca_company from mwRegister_CA where id=#{id} order by ca_name asc
	</select>
	
	<select id="bankAccount" resultType="mycardDTO" parameterType="mycardDTO"  >
		select ca_name from mwRegister_CA where id=#{id} and ca_company=#{value} 
	</select>
	
	<!-- 지출/수입 insert -->
	<insert id="insert" parameterType="moneyioDTO">
		insert into mwmoneyio values(mwmoneyio_seq.nextval,#{io_category},#{io_detail},#{io_reg_date},#{io_price},#{io_remain},#{io_bank},
		#{io_account},#{id},#{io_N_div},#{io_set},(select 2020-Birth_y+1 from mwmember where id=#{id}))
	</insert>
	
	<!-- 지출/수입  n빵 내역 insert -->
	<insert id="n_insert" parameterType="nbreadDTO">
	insert into mwn_bread values(mwnbread_seq.nextval,(select max(io_num) from mwmoneyio), (select id from mwmoneyio where io_num = (select max(io_num) from mwmoneyio))
 		, (select io_category from mwmoneyio where io_num = (select max(io_num) from mwmoneyio)),#{n_debtor},#{n_price})
	</insert>
	
	<!-- 지출/수입 내역 수정페이지 데이터 -->	
	<select id="updateForm" resultType="moneyioDTO" parameterType="int">
		select * from mwmoneyio where io_num = #{io_num} 
	</select>
	
	<!-- 지출/수입 내역 update -->
	<update id="update" parameterType="moneyioDTO">
		update mwmoneyio set io_category = #{io_category}, io_detail = #{io_detail}, io_reg_date = #{io_reg_date},
		io_price = #{io_price},io_remain = #{io_remain}, io_N_div = #{io_N_div}, io_set = #{io_set}
		where io_num = #{io_num}
	</update>

	<delete id="n_delete" parameterType="int">
		delete from mwn_bread where io_num=#{io_num}
	</delete>
	
	<insert id="n_insert2" parameterType="nbreadDTO">
		insert into mwn_bread values(mwnbread_seq.nextval,#{io_num}, (select id from mwmoneyio where io_num=#{io_num}), 
		(select io_category from mwmoneyio where io_num=#{io_num}), #{n_debtor}, #{n_price})
	</insert>
	
	<!-- 연령대별 지출 chart-20대 -->
	<select id="chart20" resultType="moneyioDTO">
	<![CDATA[
		select * from(
    		select io_category, sum(io_price) as io_price from mwmoneyio where (
        	io_age between '20' and '29') and io_category not in('n빵비', '기타') and io_set=1
    		group by io_category
    		order by io_price desc
		)where rownum <= 5
	]]>
	</select>
	
	<!-- 연령대별 지출 chart-30대 -->
	<select id="chart30" resultType="moneyioDTO">
	<![CDATA[
		select * from(
    		select io_category, sum(io_price) as io_price from mwmoneyio where (
        	io_age between '30' and '39') and io_category not in('n빵비', '기타') and io_set=1
    		group by io_category
    		order by io_price desc
		)where rownum <= 5
	]]>
	</select>
	
	<!-- 연령대별 지출 chart-40대 -->
	<select id="chart40" resultType="moneyioDTO">
	<![CDATA[
		select * from(
    		select io_category, sum(io_price) as io_price from mwmoneyio where (
        	io_age between '40' and '49') and io_category not in('n빵비', '기타') and io_set=1
    		group by io_category
    		order by io_price desc
		)where rownum <= 5
	]]>
	</select>


	<select id="moneyioListAll" resultType="moneyioDTO" parameterType="String">
		select * from mwmoneyio where id = #{id} order by io_num desc
	</select>
	
	<select id="moneyioListIn" resultType="moneyioDTO" parameterType="String">
		select * from mwmoneyio where id = #{id} and io_set = 0 order by io_num desc
	</select>
	
	<select id="moneyioListOut" resultType="moneyioDTO" parameterType="String">
		select * from mwmoneyio where id = #{id} and io_set = 1 order by io_num desc
	</select>

	<select id="moneyioListDetail" resultType="moneyioDTO" parameterType="hashmap">
		select * from mwmoneyio where id = #{id} and io_num = #{ioNum}
	</select>
	
	<select id="moneyioListRemain" resultType="moneyioDTO" parameterType="String">
		select * from mwmoneyio where io_num in (select max(io_num) from mwmoneyio where id = #{id} group by io_reg_date) order by io_num desc
	</select>
	
</mapper>